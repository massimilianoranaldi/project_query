[
  {
    "id": "1",
    "nomeCapitolo": "FIXED CRP: ESTRAZIONE EVENTI VERSO KENAN - FOCUS DATA ATTIVAZIONE/CESSAZIONE SCENARIO NP INTERNA",
    "paragrafi": [
      {
        "id": "1.1",
        "nomeParagrafo": "Estrae eventi verso il billing, con evidenza data attivazione/cessazione per int id. Utilizzata nello scenario di NP interna",
        "codicePlSql": "select distinct \nextractvalue(xmltype(m.message_xml),'descendant::ns0:idCliente','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as idCliente,\nd.value as order_id, \n--r.id as root_id, \n--r.name as root_name,\na.id,a.name, \nr.ts_created,\n(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/@tipo','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as tipo_ordine,\n--(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/@sottotipo','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as sottotipo_ordine,\n--(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/ns0:causaleOrdine','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as causale_ordine,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:extIdSI','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as extId_si,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:numeroTelefono','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as numeroTelefono,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:dataAttivazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dataAttivazione,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:dataCessazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dataCessazione,\nextractvalue(value(t),'ns0:billingElement/ns0:extIdBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as extid_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:typeOpBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as type_op_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:idBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as id_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:dtAttivazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dtAttivazione_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:dtCessazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dtCessazione_BE\n--extractvalue(value(t),'ns0:billingElement/ns0:idOrdine','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as idordine_BE\nextractvalue(xmltype(m.message_xml),'descendant::ns0:CRMtipoSI','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as CRMtipoSI,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:CRMsottotipoSI','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as CRMsottotipoSI\nfrom request r, detail d, request r1, action a, action_msg m,\nTABLE ( XMLSEQUENCE(EXTRACT(xmltype(m.message_XML),'descendant::ns0:billingElement', 'xmlns:ns0=http://billing.wind.it/esb/OrderManagement'))) t\nwhere r.id=d.root_id\nand d.name='id_odl_crm'\nand \n(\n    d.value in (-- attivazioni \n        /*'1-612511851773',\n        '1-615564746976',\n        '1-616074838718',\n        '1-615892073226',\n        '1-616676666948',\n        '1-617812697738',\n        '1-614841180873',\n        '1-617227516783', \n        '1-617379290097', \n        '1-617893341026',*/\n             '1-614940023375' -- '1-619157290421'\n) \n     or\n    d.value in ( -- cessazioni \n             '1-618125223280'--,--     \n            /* '1-617947246902',--     \n             '1-617560729470',--\n             '1-618439781329',--\n             '1-618822370337',--    live\n             '1-619066680576',--     \n             '1-616486927246',--     \n             '1-616198469176',--     \n             '1-619639156003',--    live\n             '1-619157290421'  */\n        )\n)\nand r.id=r1.root_id\nand r1.id=a.request_id\nand a.message_id=m.id\nand a.system='kenan'\nand a.direction='outbound'\norder by idcliente,tipo_ordine,numerotelefono;",
        "outPutSql": "IDCLIENTE\tORDER_ID\tID\tNAME\tTS_CREATED\tTIPO_ORDINE\tEXTID_SI\tNUMEROTELEFONO\tDATAATTIVAZIONE\tDATACESSAZIONE\tEXTID_BE\tCRMTIPOSI\tCRMSOTTOTIPOSI\n559061075\t1-618822370337\t69186009984\tDeactivation Service Instance\t01-MAR-24 08.23.28.045127000 PM\tCessazione\t1,60871E+12\tA21608711970339\t\t2024-03-01T20:25:54+01:00\t1,61E+12\tTE\tAPPCON\n559061075\t1-618822370337\t69186009984\tDeactivation Service Instance\t01-MAR-24 08.23.28.045127000 PM\tCessazione\t1,60871E+12\tA21608711970339\t\t2024-03-01T20:25:54+01:00\t1,61E+12\tTE\tAPPCON\n601099904\t1-619639156003\t69284458659\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\t415401001\t\t2024-02-26T00:00:00+01:00\t1,56E+12\tTC\tSVOIP\n601099904\t1-619639156003\t69284458659\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\t415401001\t\t2024-02-26T00:00:00+01:00\t1,56E+12\tTC\tSVOIP\n601099904\t1-619639156003\t69284459710\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\tA21562750044945\t\t2024-03-12T13:02:12+01:00\t1,56E+12\tTE\tAPPCON\n601099904\t1-619639156003\t69284459710\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\tA21562750044945\t\t2024-03-12T13:02:12+01:00\t1,56E+12\tTE\tAPPCON\n601099904\t1-619639156003\t69284460185\tChange Billing Element Account Level\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t\t\t\t\t1,56E+12\t\t"
      }
    ]
  },
  {
    "id": "2",
    "nomeCapitolo": "FIXED CRP: CHECK WC/QC e LOGISTICA",
    "paragrafi": [
      {
        "id": "2.1",
        "nomeParagrafo": "Estrae per ogni ordine le caratteristiche legate alla WC/WC, gli esiti di sblocco e le date di start delle subrequest",
        "codicePlSql": "select * from\n(select r.id as root_id,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:idCommercialOrder','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as id_ordine, \n r.name as req_name,\n extractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:bssOrder','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as bssOrder,\n  extractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:datiOrder/ns0:flagContCli','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as flagContCli,\n    extractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:flagWCall','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as flagWCall,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:datiVenditore/ns0:canaleVendita','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as canaleVendita,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/@tipo','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as tipo,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/@sottotipo','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as sottotipo, \nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:causaleOrdine','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as causale,\nr.ts_created, r.status as req_root_status,\n(select ts_end from action where request_id=r.id and name='Response Request async CVP') as OutcomeCvp --- Esito CVP\n,(select ts_end from action where request_id=r.id and name='Send Welcome Call') as Send_WC --invio richiesta sblocco verso siebel \n,(select ts_end from action where request_id=r.id and name='Receive Welcome Call Response') as ResponseWC_ACK --presa in carico\n,(select ts_end from action where request_id=r.id and name='Receive Unlock Order') as Receive_Order_UNLOCK --CONTINUE - sblocco logistica\n,(select ts_end from action where request_id=r.id and name='Receive Unlock Order Wireline') as Receive_UnlockOrder_SP--END_FIS, manda in abort la SP\n,(select z.ts_end from action z, request zz where z.request_id = zz.id and zz.root_id = r.root_id and zz.name = 'MnpRecipient' and z.name ='Send Request Mnp') as SendRequestMNP_date\n,(select z.ts_end from action z, request zz where z.request_id = zz.id and zz.root_id = r.root_id and zz.name = 'MnpRecipient' and z.name ='Recipient outcome Mnp') as RecipientOutcome_Mnp_date\n,(select count(*) from request where root_id=r.id and name='Logistics') as Logistiche \n,(select count(*) from request where root_id=r.id and name='Network') as Network \n,(select count(*) from request where root_id=r.id and name='MnpRecipient') as MnpRecipient\n,(select count(*) from request where root_id=r.id and name='Service Provisioning') as SP  \n,(select count (*) from action where request_id=r.id and name='Receive Unlock Order') as UnlockMob --invio richiesta sblocco verso siebel \n,(select count (*) from action where request_id=r.id and name='Receive Unlock Order Wireline') as UnlockFixed\n,(select z.ts_end from action z, request zz where z.request_id = zz.id and zz.root_id = r.root_id and zz.name = 'Service Provisioning' and z.name ='Send Order Service Provisioning') as Avvio_SP\n,(select count (*) from action z, request zz where z.request_id = zz.id and zz.root_id= r.root_id and zz.name = 'Logistics' and z.name ='Send order odn') as LogisticsDetails\n,(select z.ts_end from action z, request zz where z.request_id = zz.id and zz.root_id= r.root_id and zz.name = 'Logistics' and z.name ='Send order odn') as LogisticsDetails_date\n,(select count (*) from action z, request zz where z.request_id = zz.id and zz.root_id = r.root_id and zz.name = 'Logistics' and z.name ='Send order handset odvr') as LogisticsDetailsCPE\n,(select z.ts_end from action z, request zz where z.request_id = zz.id and zz.root_id = r.root_id and zz.name = 'Logistics' and z.name ='Send order handset odvr') as LogisticsDetailsCPE_date\n--,(select 1 from request where root_id=r.id and name='Network') as network --END_FIS, manda in abort la SP\nfrom request r, request_doc d\nwhere \nr.name in ('In Order', 'Extend Order')\nand  exists (select 1 from action z where z.request_id = r.id and z.name in \n('Receive Unlock Order','Receive Unlock Order', 'Receive Welcome Call Response','Receive Unlock Order Wireline') \nand z.status = 'SA')\nand exists (select 1 from action z, request zz where z.request_id = zz.id and zz.root_id= r.root_id and zz.name = 'Logistics' and z.name ='Send order odn')\nand exists (select 1 from request zz where zz.root_id= r.root_id and zz.name = 'Service Provisioning')\n--and r.id in ('3499623899','3484883109','3431904065','3467353921','3421860956','3425204563')\nand r.ts_created>to_date('01/06/2024', 'dd/mm/yyyy')\nand r.document_id=d.id\nand r.status = 'SA'\n and rownum<10)",
        "outPutSql": "ROOT_ID\tID_ORDINE\tREQ_NAME\tBSSORDER\tFLAGCONTCLI\tFLAGWCALL\tCANALEVENDITA\tTIPO\tSOTTOTIPO\tCAUSALE\tTS_CREATED\tREQ_ROOT_STATUS\tOUTCOMECVP\tSEND_WC\tRESPONSEWC_ACK\tORDER_UNLOCK\tUNLOCKORDER_SP\tLOGISTICHE\tNETWORK\tMNPRECIPIENT\tSP\tUNLOCKMOB\tUNLOCKFIXED\tLOGISTICSDETAILS\tLOGISTICSDETAILSCPE\n3549012487\t1-629354705694\tIn Order\tY\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t27-JUN-24 07.31.49.129163000 PM\tSA\t28-JUN-24 08.58.33.000000000 AM\t28-JUN-24 08.58.36.000000000 AM\t28-JUN-24 08.58.36.000000000 AM\t\t28-JUN-24 11.29.18.000000000 AM\t0\t0\t0\t1\t0\t1\t0\t0\n3570289096\t1-631900871753\tIn Order\tY\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t25-JUL-24 05.08.21.476784000 PM\tSA\t26-JUL-24 09.58.37.000000000 AM\t26-JUL-24 10.23.11.000000000 AM\t26-JUL-24 10.23.12.000000000 AM\t27-JUL-24 09.40.47.000000000 PM\t30-JUL-24 09.42.45.000000000 AM\t2\t1\t0\t2\t1\t1\t0\t2\n3574461716\t1-632399173651\tIn Order\t\tY\tN\tEX\tAttivazione\tAttivazione\tPrima Attivazione\t31-JUL-24 05.37.43.091181000 PM\tSA\t31-JUL-24 08.07.28.000000000 PM\t31-JUL-24 08.07.30.000000000 PM\t31-JUL-24 08.07.30.000000000 PM\t\t07-AUG-24 10.21.56.000000000 AM\t0\t0\t0\t1\t0\t1\t0\t0\n3578439547\t1-632908479369\tIn Order\tY\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t06-AUG-24 11.19.43.004896000 AM\tSA\t06-AUG-24 12.04.50.000000000 PM\t06-AUG-24 12.04.53.000000000 PM\t06-AUG-24 12.04.54.000000000 PM\t\t10-AUG-24 10.10.41.000000000 AM\t0\t0\t0\t1\t0\t1\t0\t0\n3568437865\t1-631680491604\tIn Order\tY\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t23-JUL-24 03.10.31.576717000 PM\tSA\t23-JUL-24 05.29.12.000000000 PM\t23-JUL-24 05.29.25.000000000 PM\t23-JUL-24 05.29.25.000000000 PM\t\t24-JUL-24 09.31.43.000000000 AM\t0\t0\t0\t1\t0\t1\t0\t0\n3572370220\t1-632117269092\tIn Order\tY\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t29-JUL-24 02.03.31.758450000 PM\tSA\t29-JUL-24 03.44.05.000000000 PM\t29-JUL-24 03.46.46.000000000 PM\t29-JUL-24 03.46.46.000000000 PM\t\t30-JUL-24 08.48.16.000000000 AM\t1\t1\t0\t1\t0\t1\t0\t1\n3563041104\t1-630929161251\tIn Order\t\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t16-JUL-24 09.34.21.908998000 AM\tSA\t29-JUL-24 11.22.20.000000000 AM\t29-JUL-24 11.43.29.000000000 AM\t29-JUL-24 11.43.29.000000000 AM\t\t31-JUL-24 11.09.05.000000000 AM\t0\t0\t0\t2\t0\t1\t0\t0\n3567585601\t1-631574862220\tIn Order\tY\tY\tN\tTM\tAttivazione\tAttivazione\tPrima Attivazione\t22-JUL-24 05.29.02.192241000 PM\tSA\t23-JUL-24 09.15.56.000000000 AM\t23-JUL-24 09.15.59.000000000 AM\t23-JUL-24 09.15.59.000000000 AM\t\t25-JUL-24 09.28.40.000000000 AM\t1\t0\t0\t1\t0\t1\t0\t1\n3578463658\t1-632914755505\tIn Order\t\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t06-AUG-24 11.44.32.894612000 AM\tSA\t06-AUG-24 03.25.03.000000000 PM\t06-AUG-24 03.25.05.000000000 PM\t06-AUG-24 03.25.05.000000000 PM\t\t06-AUG-24 05.32.28.000000000 PM\t0\t0\t0\t1\t0\t1\t0\t0"
      }
    ]
  }
]