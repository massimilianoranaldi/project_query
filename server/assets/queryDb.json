[
  {
    "id": "111",
    "nomeCapitolo": "FIXED CRP: ESTRAZIONE EVENTI VERSO KENAN - FOCUS DATA ATTIVAZIONE/CESSAZIONE SCENARIO NP INTERNA",
    "paragrafi": [
      {
        "id": "1.1",
        "nomeParagrafo": "Estrae eventi verso il billing, con evidenza data attivazione/cessazione per int id. Utilizzata nello scenario di NP interna",
        "codicePlSql": "select distinct \nextractvalue(xmltype(m.message_xml),'descendant::ns0:idCliente','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as idCliente,\nd.value as order_id, \n--r.id as root_id, \n--r.name as root_name,\na.id,a.name, \nr.ts_created,\n(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/@tipo','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as tipo_ordine,\n--(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/@sottotipo','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as sottotipo_ordine,\n--(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/ns0:causaleOrdine','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as causale_ordine,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:extIdSI','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as extId_si,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:numeroTelefono','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as numeroTelefono,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:dataAttivazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dataAttivazione,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:dataCessazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dataCessazione,\nextractvalue(value(t),'ns0:billingElement/ns0:extIdBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as extid_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:typeOpBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as type_op_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:idBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as id_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:dtAttivazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dtAttivazione_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:dtCessazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dtCessazione_BE\n--extractvalue(value(t),'ns0:billingElement/ns0:idOrdine','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as idordine_BE\nextractvalue(xmltype(m.message_xml),'descendant::ns0:CRMtipoSI','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as CRMtipoSI,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:CRMsottotipoSI','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as CRMsottotipoSI\nfrom request r, detail d, request r1, action a, action_msg m,\nTABLE ( XMLSEQUENCE(EXTRACT(xmltype(m.message_XML),'descendant::ns0:billingElement', 'xmlns:ns0=http://billing.wind.it/esb/OrderManagement'))) t\nwhere r.id=d.root_id\nand d.name='id_odl_crm'\nand \n(\n    d.value in (-- attivazioni \n        /*'1-612511851773',\n        '1-615564746976',\n        '1-616074838718',\n        '1-615892073226',\n        '1-616676666948',\n        '1-617812697738',\n        '1-614841180873',\n        '1-617227516783', \n        '1-617379290097', \n        '1-617893341026',*/\n             '1-614940023375' -- '1-619157290421'\n) \n     or\n    d.value in ( -- cessazioni \n             '1-618125223280'--,--     \n            /* '1-617947246902',--     \n             '1-617560729470',--\n             '1-618439781329',--\n             '1-618822370337',--    live\n             '1-619066680576',--     \n             '1-616486927246',--     \n             '1-616198469176',--     \n             '1-619639156003',--    live\n             '1-619157290421'  */\n        )\n)\nand r.id=r1.root_id\nand r1.id=a.request_id\nand a.message_id=m.id\nand a.system='kenan'\nand a.direction='outbound'\norder by idcliente,tipo_ordine,numerotelefono;",
        "outPutSql": "IDCLIENTE\tORDER_ID\tID\tNAME\tTS_CREATED\tTIPO_ORDINE\tEXTID_SI\tNUMEROTELEFONO\tDATAATTIVAZIONE\tDATACESSAZIONE\tEXTID_BE\tCRMTIPOSI\tCRMSOTTOTIPOSI\n559061075\t1-618822370337\t69186009984\tDeactivation Service Instance\t01-MAR-24 08.23.28.045127000 PM\tCessazione\t1,60871E+12\tA21608711970339\t\t2024-03-01T20:25:54+01:00\t1,61E+12\tTE\tAPPCON\n559061075\t1-618822370337\t69186009984\tDeactivation Service Instance\t01-MAR-24 08.23.28.045127000 PM\tCessazione\t1,60871E+12\tA21608711970339\t\t2024-03-01T20:25:54+01:00\t1,61E+12\tTE\tAPPCON\n601099904\t1-619639156003\t69284458659\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\t415401001\t\t2024-02-26T00:00:00+01:00\t1,56E+12\tTC\tSVOIP\n601099904\t1-619639156003\t69284458659\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\t415401001\t\t2024-02-26T00:00:00+01:00\t1,56E+12\tTC\tSVOIP\n601099904\t1-619639156003\t69284459710\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\tA21562750044945\t\t2024-03-12T13:02:12+01:00\t1,56E+12\tTE\tAPPCON\n601099904\t1-619639156003\t69284459710\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\tA21562750044945\t\t2024-03-12T13:02:12+01:00\t1,56E+12\tTE\tAPPCON\n601099904\t1-619639156003\t69284460185\tChange Billing Element Account Level\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t\t\t\t\t1,56E+12\t\t"
      }
    ]
  }
]
